<div class="home-content white-text">

  <!--<a href="https://www.notion.so/pkn/RainRadar-60-176fc6c2da374d29aacf4a63aeba2cb2" target="_blank" rel="nofollow" class="white-text">
    <div class="card-panel teal domain-change-block">
      <b>RainRadar เปลี่ยนเซิร์ฟเวอร์ภาพเรดาร์ใหม่ ดูภาพเรดาร์เร็วขึ้นกว่า 60% คลิกที่นี่เพื่อดูข้อมูลเพิ่มเติม</b>
    </div>
  </a>-->

  <!--<a href="https://radar.openbase.co/?r=1#cri" class="white-text">
    <div class="card-panel green darken-3 cri-radar-block">
      [ ยอดนิยม ] เรดาร์เชียงรายกำลังได้รับความนิยมสูง คลิกเพื่อดูเรดาร์
    </div>
  </a>-->

  <div class="card-panel indigo weather-alert-block white-text">
    <h5 class="block-header flow-text">ประกาศล่าสุดจากกรมอุตุนิยมวิทยา</h5>
    <iframe id="alert-header" src="/content/weatheralertheader.html" frameborder="0"></iframe>
  </div>

  <div class="card-panel grey darken-1 aqi-open-block modal-trigger" data-target="modal" data-identity="aqi" data-url="../content/aqi.html?v=8.3.3">
    <h5 class="block-header"><span class="new-badge white-text red">ใหม่</span> ข้อมูลคุณภาพอากาศ (AQI)</h5>
  </div>

  <div class="card-panel pink fc-block">
    <h5 class="block-header flow-text">พยากรณ์อากาศจากกรมอุตุนิยมวิทยา</h5>
    <br><img id="tmdforecast" src="" alt="พยากรณ์อากาศประจำวันจากกรมอุตุนิยมวิทยา">

  </div>

  <div class="card-panel blue-grey heavy-rain-block">
    <h5 class="block-header flow-text">แผนที่แสดงพื้นที่เสี่ยงภัยฝนตกหนักถึงหนักมาก</h5>
    <br><img id="tmdheavyrain" src="" alt="แผนที่แสดงพื้นที่เสี่ยงภัยฝนตกหนักถึงหนักมากประจำวันจากกรมอุตุนิยมวิทยา">

  </div>

  <a href="https://www.notion.so/RainRadar-1e747bde466749aa8ae07b8a5f88d416" target="_blank" rel="nofollow" class="white-text">
    <div class="card-panel indigo get-started-block">
        <h5 class="block-header flow-text">ใช้งานเป็นครั้งแรก? คลิกที่นี่เพื่อดูวิธีใช้งานเบื้องต้น</h5>
    </div>
  </a>

  <div class="card-panel green darken-1">
    หากพบปัญหาในการใช้งาน ลองดูที่เมนู > ช่วยเหลือ
    <br />ต้องการแจ้งปัญหา, ติชม หรือเสนอแนะ กรอกข้อมูลใน<a class="yellow-text" href="https://goo.gl/forms/xc7GyxU52zxnemPB3" target="_blank">แบบฟอร์มนี้</a>
  </div>
</div>

<script>
var d = new Date(),
    xyear = d.getFullYear(),
    xmonth = (d.getMonth() + 1),
    xdate = d.getDate(),
    rdate = d.getDate(),
    xdate2 = (d.getDate() - 1),
    xhour = d.getHours(),
    fcimg = $("#tmdforecast");
    rnimg = $("#tmdheavyrain");

if (xmonth < 10) {
  xmonth = "0" + xmonth;
}
if (xhour < 13) {
  xdate = xdate - 1;
}
if (xdate < 10) {
  xdate = "0" + xdate;
}
if (xhour >= 13) {
  xhour = "1200";
}
if (xhour < 13) {
  xhour = "2300";
}

var forecastdate = xyear + "-" + xmonth + "-";
var fcimgurl = "https://images.weserv.nl/?url=www.tmd.go.th/programs/uploads/forecast/" + forecastdate + xdate + "_DFTH1_" + xhour + ".jpg&w=1024";
var rnimgurl = "https://images.weserv.nl/?url=www.tmd.go.th/programs/uploads/forecast/" + forecastdate + xdate + "_DFTH2_1200.jpg&w=1024";

fcimg.attr("src", fcimgurl);

rnimg.attr("src", rnimgurl);

rnimg.on('error', function() {
  $(".heavy-rain-block").html("ขออภัยไม่สามารถโหลดพื้นที่เสี่ยงภัยฝนตกหนักได้");
});

fcimg.on('error', function() {
  if (xhour = "1200" && xdate2 != "0") {
    if (xdate2 < 10) {
      xdate2 = "0" + xdate2;
    }
    fcimgurl = "https://images.weserv.nl/?url=www.tmd.go.th/programs/uploads/forecast/" + forecastdate + xdate2 + "_DFTH1_2300.jpg&w=1024";
    fcimg.attr("src", fcimgurl);
    console.log(forecastdate + xdate2 + "-2300");
    fcimg.on('error', function() {
      $(".fc-block").html("ขออภัย ไม่สามารถโหลด<a href=" + fcimgurl + " class=\"white-text\">ข้อมูลพยากรณ์อากาศได้</a>");
    });
  } else {
    $(".fc-block").html("ขออภัย ไม่สามารถโหลด<a href=" + fcimgurl + " class=\"white-text\">ข้อมูลพยากรณ์อากาศได้</a>");
    console.log(forecastdate + " - " + xhour);
  }
});

function resizeIframe(obj) {
  obj.style.height = 0;
  obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
}

function loadWeatherAlert() {
  $('#modal').modal('open');
  window.history.replaceState({}, "", "/#weatheralert");
  $(".modal").attr("alt", "weatheralert");
  gtag('config', 'UA-78233854-2', {
    'page_path': '/#weatheralert'
  });
  mdcnt.load("/content/weatheralert.html", function(response, status) {
    if (status == "error") {
      mdcnt.html("ไม่สามารถโหลดข้อมูล");
    }
  });
}

// Weather alert
$('.weather-alert-block').click(function() {
  loadWeatherAlert();
});

$('#alert-header').on('load', function() {
  resizeIframe(this);
  $(this).contents().find("body").on('click', function(event) {
    loadWeatherAlert();
  });
});

$(".modal-trigger").click(function() {
  modalhash = "home";
  var data = $(this).data();
  $(".modal").attr("alt", data.identity);
  window.history.replaceState({}, "", "/#" + data.identity);
  gtag('config', 'UA-78233854-2', {
    'page_path': '/#' + data.identity
  });
  mdcnt.load(data.url, function(response, status) {
    if (status == "error") {
      mdcnt.html("ไม่สามารถโหลดข้อมูล");
    }
  });
});

</script>
