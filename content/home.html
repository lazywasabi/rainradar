<div class="white-text">

  <a href="/?r=1#termsandprivacy">
    <div class="card-panel black radar-privacy-change white-text" style="font-size: 1.1em;">
      RainRadar มีการปรับปรุงนโยบายความเป็นส่วนตัว คลิกที่นี่เพื่อดูรายละเอียด
    </div>
  </a>

  <div class="card-panel green darken-3 adblock-notice" style="font-size: .95em;">
    หากพบปัญหาโหลดข้อมูลการจราจรไม่ได้ กรุณาปิดตัวบล็อกโฆษณา<br/><span style="font-size: .85em;">RainRadar ให้บริการฟรีโดยไม่มีโฆษณา</span>
  </div>

  <!--
  <div class="card-panel green darken-3 http-block">
    <a href="https://github.com/pknme/rainradar/blob/master/CHANGELOG.md" target="_blank" class="white-text"><b>[ ใหม่ ] RainRadar อัปเดตเป็นเวอร์ชัน 8.0.0-beta1 คลิกเพื่อดูรายละเอียด</b></a>
  </div>
  -->

  <div class="card-panel pink fc-block">
    <h5 style="margin:0;">พยากรณ์อากาศจากกรมอุตุนิยมวิทยา</h5>
    <br><img id="tmdforecast" src="" alt="พยากรณ์อากาศประจำวันจากกรมอุตุนิยมวิทยา">
  </div>
  
  <div class="card-panel blue-grey aqi-container-block">
    <h5 style="margin:0 0 .8rem;"><span class="red" style="padding: 0 10px;">ใหม่!</span> ข้อมูลคุณภาพอากาศจาก <a href="https://aqicn.org" class="white-text" target="_blank">aqicn.org</a></h5>
    <div id="aqi-block" class="aqi-block blue-grey"></div>
    <h6>*กลุ่มอ่อนไหว = เด็ก, ผู้สูงอายุ, ผู้ป่วยโรคทางเดินหายใจ</h6>
  </div>

  <div class="card-panel green">
    หากพบปัญหาในการใช้งาน ลองดูที่เมนู > ช่วยเหลือ
    <br/>ต้องการแจ้งปัญหา, ติชม หรือเสนอแนะ กรอกข้อมูลใน<a class="yellow-text" href="https://goo.gl/forms/xc7GyxU52zxnemPB3" target="_blank">แบบฟอร์มนี้</a>
  </div>
</div>

<script>
  var d = new Date(),
    xyear = d.getFullYear(),
    xmonth = (d.getMonth() + 1),
    xdate = d.getDate(),
    xdate2 = (d.getDate() - 1),
    xhour = d.getHours(),
    fcimg = $("#tmdforecast");

  if (xmonth < 10) {
    xmonth = "0" + xmonth;
  }
  if (xdate < 10) {
    xdate = "0" + xdate;
  }
  if (xhour >= 13) {
    xhour = "1200";
  }
  if (xhour < 13) {
    xhour = "2300";
  }

  var forecastdate = xyear + "-" + xmonth + "-";
  var fcimgurl = "https://images.weserv.nl/?url=www.tmd.go.th/programs/uploads/forecast/" + forecastdate + xdate + "_DFTH1_" + xhour + ".jpg&w=1024";

  fcimg.attr("src", fcimgurl);

  fcimg.on('error', function() {
    if (xhour = "1200" && xdate2 != "0") {
      if (xdate2 < 10) {
        xdate2 = "0" + xdate2;
      }
      fcimgurl = "https://images.weserv.nl/?url=www.tmd.go.th/programs/uploads/forecast/" + forecastdate + xdate2 + "_DFTH1_2300.jpg&w=1024";
      fcimg.attr("src", fcimgurl);
      console.log(forecastdate + xdate2 + "-2300");
      fcimg.on('error', function() {
        $(".fc-block").html("ขออภัย ไม่สามารถโหลด<a href=" + fcimgurl + " class=\"white-text\">ช้อมูลพยากรณ์อากาศได้");
      });
    } else {
      $(".fc-block").html("ขออภัย ไม่สามารถโหลด<a href=" + fcimgurl + " class=\"white-text\">ช้อมูลพยากรณ์อากาศได้");
      console.log(forecastdate + " - " + xhour);
    }
  });

  (function(w, d, t, f) {
    w[f] = w[f] || function(c, k, n) {
      s = w[f], k = s['k'] = (s['k'] || (k ? ('&k=' + k) : ''));
      s['c'] =
        c = (c instanceof Array) ? c : [c];
      s['n'] = n = n || 0;
      L = d.createElement(t), e = d.getElementsByTagName(t)[0];
      L.async = 1;
      L.src = '//feed.aqicn.org/feed/' + (c[n].city) + '/' + (c[n].lang || '') + '/feed.v1.js?n=' + n + k;
      e.parentNode.insertBefore(L, e);
    };
  })(window, document, 'script', '_aqiFeed');

  var cities = [
    "bangkok",
    "thailand/regional-environmental-office-8/",
    "rayong",
    "thailand/saraburi/khao-noi-fire-station/",
    "thailand/nakhon-sawan/nakhonsawan-irrigation/",
    "thailand/tak/mae-sot/mae-pa/",
    "thailand/lampang-meteorological-station/",
    "chiang-mai",
    "mueang-chiang-rai",
    "thailand/khonkaen",
    "thailand/surat-thani/regional-environmental-office-14/",
    "thailand/phuket/municipal-health-center-1/"
  ];
  var aqiWidgetConfig = [];
  cities.forEach(function(city) {
    aqiWidgetConfig.push({
      city: city,
      callback: displayCity,
    });
  });
  _aqiFeed(aqiWidgetConfig);

  function displayCity(aqi) {

    //console.log(aqi);

    if (aqi.cityname === "Bangkok") aqi.cityname = "กรุงเทพฯ";
    if (/office 8/i.test(aqi.cityname)) aqi.cityname = "ราชบุรี";
    if (aqi.cityname === "Rayong") aqi.cityname = "ระยอง";
    if (/Saraburi/i.test(aqi.cityname)) aqi.cityname = "สระบุรี";
    if (/nakhonsawan/i.test(aqi.cityname)) aqi.cityname = "นครสวรรค์";
    if (/Tak/i.test(aqi.cityname)) aqi.cityname = "อ.แม่สอด, ตาก";
    if (/Lampang/i.test(aqi.cityname)) aqi.cityname = "ลำปาง";
    if (aqi.cityname === "Chiang Mai") aqi.cityname = "เชียงใหม่";
    if (aqi.cityname === "Mueang Chiang Rai") aqi.cityname = "เชียงราย";
    if (aqi.cityname === "Khonkaen") aqi.cityname = "ขอนแก่น";
    if (/Surat/i.test(aqi.cityname)) aqi.cityname = "สุราษฎร์ธานี";
    if (/Phuket/i.test(aqi.cityname)) aqi.cityname = "ภูเก็ต";
    if (aqi.impact === "Good") aqi.impact = "คุณภาพดี";
    if (aqi.impact === "Moderate") aqi.impact = "คุณภาพปานกลาง";
    if (aqi.impact === "Unhealthy for Sensitive Groups") aqi.impact = "ไม่ดีต่อกลุ่มอ่อนไหว*";
    if (aqi.impact === "Unhealthy") aqi.impact = "ไม่ดีต่อสุขภาพ";
    if (aqi.impact === "Very Unhealthy") aqi.impact = "ไม่ดีต่อสุขภาพมาก";
    if (aqi.impact === "Hazardous") aqi.impact = "อันตราย";
    if (aqi.impact === "no data") aqi.impact = "ไม่มีข้อมูล";

    $("#aqi-block").append(aqi.text(
      "<div class=\"aqi-display\"><div class=\"flow-text\">%cityname</div><div style=\"%style;font-size:2em;padding:3px 8px;margin:10px 0;\">%aqi</div><p>%impact<br><small>%date</small></p></div>"
    ));
  }
</script>
