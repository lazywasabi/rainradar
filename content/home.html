<div class="white-text">
  <div class="card-panel blue">
    <svg fill="#fff" height="150" viewbox="0 0 24 24" width="150" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none" /><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z" /></svg>
    <h5>ยินดีต้อนรับ</h5>
    เลือกข้อมูลที่ต้องการดูจากเมนูด้านบน
  </div>

  <div class="card-panel red darken-3 http-block">
    <b>[ ประกาศ ] เปลี่ยนที่อยู่เว็บไซต์เป็น radar.pknme.com และทดลองบังคับใช้งานผ่าน HTTPS ตั้งแต่ 8 ก.พ. 2561 เป็นต้นไป</b>
  </div>

  <div class="card-panel blue-grey">
    <h5 style="margin:0 0 .8rem;">ใหม่! ข้อมูลคุณภาพอากาศจาก aqin.org</h5>
    <div  id="aqi-block" class="aqi-block blue-grey"></div>
  </div>

  <div class="card-panel pink fc-block">
    <h5 style="margin:0;">พยากรณ์อากาศจากกรมอุตุนิยมวิทยา</h5>
    <br><img id="tmdforecast" src="" alt="พยากรณ์อากาศประจำวันจากกรมอุตุนิยมวิทยา">
  </div>

  <div class="card-panel green">
    หากพบปัญหาในการใช้งาน ลองดูที่เมนู > ช่วยเหลือ
    <br/>ต้องการแจ้งปัญหา, ติชม หรือเสนอแนะ กรอกข้อมูลใน<a class="yellow-text" href="https://goo.gl/forms/xc7GyxU52zxnemPB3" target="_blank">แบบฟอร์มนี้</a>
  </div>
</div>

<script>
  var d = new Date(),
    xyear = d.getFullYear(),
    xmonth = (d.getMonth() + 1),
    xdate = d.getDate(),
    xdate2 = (d.getDate() - 1),
    xhour = d.getHours(),
    fcimg = $("#tmdforecast");

  if (xmonth < 10) {
    xmonth = "0" + xmonth;
  }
  if (xdate < 10) {
    xdate = "0" + xdate;
  }
  if (xhour >= 13) {
    xhour = "1200";
  }
  if (xhour < 13) {
    xhour = "2300";
  }

  var forecastdate = xyear + "-" + xmonth + "-";
  var fcimgurl = "https://images.weserv.nl/?url=www.tmd.go.th/programs/uploads/forecast/" + forecastdate + xdate + "_DFTH1_" + xhour + ".jpg";

  fcimg.attr("src", fcimgurl);

  fcimg.on('error', function() {
    if (xhour = "1200" && xdate2 != "0") {
      if (xdate2 < 10) {
        xdate2 = "0" + xdate2;
      }
      fcimgurl = "https://images.weserv.nl/?url=www.tmd.go.th/programs/uploads/forecast/" + forecastdate + xdate2 + "_DFTH1_2300.jpg";
      fcimg.attr("src", fcimgurl);
      console.log(forecastdate + xdate2 + "-2300");
    } else {
      $(".fc-block").html("ขออภัย ไม่สามารถโหลด<a href=" + fcimgurl + " class=\"white-text\">ช้อมูลพยากรณ์อากาศได้");
      console.log(forecastdate + " - " + xhour);
    }
  });

  (function(w, d, t, f) {
    w[f] = w[f] || function(c, k, n) {
      s = w[f], k = s['k'] = (s['k'] || (k ? ('&k=' + k) : ''));
      s['c'] =
        c = (c instanceof Array) ? c : [c];
      s['n'] = n = n || 0;
      L = d.createElement(t), e = d.getElementsByTagName(t)[0];
      L.async = 1;
      L.src = '//feed.aqicn.org/feed/' + (c[n].city) + '/' + (c[n].lang || '') + '/feed.v1.js?n=' + n + k;
      e.parentNode.insertBefore(L, e);
    };
  })(window, document, 'script', '_aqiFeed');

  var cities = ["bangkok", "rayong", "chiang-mai", "mueang-chiang-rai", "thailand/nakhon-ratchasima/municipal-waste-water-pumping-station/", "thailand/khonkaen", "thailand/surat-thani/regional-environmental-office-14/", "thailand/phuket/municipal-health-center-1/"];
  var aqiWidgetConfig = [];
  cities.forEach(function(city) {
    aqiWidgetConfig.push({
      city: city,
      callback: displayCity,
    });
  });
  _aqiFeed(aqiWidgetConfig);

  function displayCity(aqi) {

    //console.log(aqi);

    if (aqi.cityname === "Bangkok") aqi.cityname = "กรุงเทพ";
    if (aqi.cityname === "Rayong") aqi.cityname = "ระยอง";
    if (aqi.cityname === "Chiang Mai") aqi.cityname = "เชียงใหม่";
    if (aqi.cityname === "Mueang Chiang Rai") aqi.cityname = "เชียงราย";
    if (/Ratchasima/i.test(aqi.cityname)) aqi.cityname = "นครราชสีมา";
    if (aqi.cityname === "Khonkaen") aqi.cityname = "ขอนแก่น";
    if (/Surat/i.test(aqi.cityname)) aqi.cityname = "สุราษฎร์ธานี";
    if (/Phuket/i.test(aqi.cityname)) aqi.cityname = "ภูเก็ต";
    if (aqi.impact === "Good") aqi.impact = "ดี";
    if (aqi.impact === "Moderate") aqi.impact = "ปานกลาง";
    if (/Sensitive/i.test(aqi.impact)) aqi.impact = "ไม่ดีต่อกลุ่มเสี่ยง";
    if (/Unhealthy/i.test(aqi.impact)) aqi.impact = "ไม่ดีต่อสุขภาพ";
    if (/Very/i.test(aqi.cityname)) aqi.impact = "ไม่ดีต่อสุขภาพมาก";
    if (/Hazardous/i.test(aqi.impact)) aqi.impact = "อันตราย";

    $("#aqi-block").append(aqi.text(
      "<div class=\"aqi-display\"><span class=\"flow-text\">%cityname</span><br><span style=\"font-size:2em;padding:3px 8px;\">%aqi</span><br>%impact<br><small>%date</small></div>"
    ));
  }
</script>

<style>
  .aqi-block {
    background: #eee;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: stretch;
    align-content: space-between;
  }
  .aqi-display {
    flex-grow: 1;
    flex-basis: 50%;
    padding: 12px 10px;
    border-bottom: 1px solid #fff;
  }
  .aqi-display:nth-last-child(-n+2) {
    border:0;
  }
  @media only screen and (min-width: 870px) {
    .aqi-display {
      flex-basis: 33.333%;
    }
  }
  .aqi-impact {
    padding: 5px 10px;
  }
</style>
